---
title : "__`utilitR`__"
subtitle : "Une documentation sur `R` à l’usage des statisticiens publics"
author : "Lino Galiana, Olivier Meslin"
institute : "Insee"
date : "`r format(Sys.time(), '%d %B %Y')`"
output :
  utilitr::utilitr_presentation:
    css: custom.css
    includes :
      after_body : insert-logo.html
---
# Introduction

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

.sauterligne3[
Le projet `utilitR` vise à produire une documentation collaborative sur `R`, destinée principalement aux agents du Service statistique public (mais pas exclusivement).
]

--
.sauterligne2[
Plan de la présentation :
]

- Genèse et objectif du projet ;
- Contenu de la documentation ;
- Modes de diffusion de la documentation ;
- Fonctionnement du projet `utilitR`.



```{r, echo = FALSE, warning = FALSE, eval = FALSE}
library(knitr)
library(kableExtra)
library(data.table)
description_appariement <- 
  as.data.table(
    data.frame(
      etape = c(
        rep('Utiliser `R` à l’Insee', 4),
        rep("Mener un projet statistique avec `R`", 5),
        rep("Importer des données", 3),
        rep("Manipuler des données", 3),
        rep("Produire des _outputs_", 3)
        ),
      filtres_validation = 
        c(
          "Les environnements de travail avec `R` à l'Insee : AUSv3 et SSP Cloud", 
          "Configurer Git et Gitlab",
          "Personnaliser la configuration de `R`",
          "Gérer les ressources informatiques avec `R`",
          "Utiliser les projets RStudio",
          "Utiliser Git avec RStudio",
          "Installer des packages et gérer les dépendances",
          "Choisir des packages",
          "Demander de l'aide et se documenter",
          "Importer des données (SAS, csv, txt, odt, xlsx...)",
          "Utiliser une API",
          "Utiliser des bases de données",
          "Manipuler des données avec `data.table`",
    # + Manipuler des données (table des données, données textuelles, données spatiales) ;
    # + Utiliser des bases de données PostgreSQL et Oracle ;
    # + Faire des graphiques ;
    # + Rédiger des documents avec `R Markdown` ;
    # + Produire des rapports automatisés avec `R Markdown`.
          "BBB",
          "AAA",
          "BBB",
          "AAA",
          "BBB"
        )
    )
  )

kbl(description_appariement, align = "cll",
    col.names = c("Partie", 
                  "Fiches")
) %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(0, align = 'c') %>%
  column_spec(1, bold = TRUE, width = "6cm") %>%
  column_spec(2, width = "12cm") %>% 
  collapse_rows(columns = 1, 
                valign = "middle", 
                longtable_clean_cut = TRUE)
```


---

# Genèse du projet

Le projet `utilitR` est parti de deux constats : 

1. **La transition des agents vers `R` est freinée par une multiplicité d’obstacles** :
    + Eclatement de la documentation de l'écosystème `R` ;
    + Multiplicité de *packages*, de qualité variable et parfois redondants ;
    + Barrière linguistique : la grande majorité de la documentation est en anglais ;
    + Diversité des cas d'usage de `R` à l'Insee et dans le SSP ;
    
--

2. **Face à ces difficultés, il n'existe pas de documentation de référence sur l'usage de `R` par les statisticiens** :
    +  La documentation de référence sur `SAS` en français, rédigée par
Axelle Chauvet et largement diffusée à l’Insee et dans le SSP, n'a pas d'équivalent en `R` ;
    + La documentation sur `R` est riche mais propose peu d'exemples sur données réelles, proches des cas d'usage des agents.

---
# Objectif du projet

.sauterligne[
La documentation `utilitR` vise à répondre à deux questions :
]

- Comment (bien) travailler avec `R` pour profiter de la richesse de son écosystème ;
- Comment réaliser efficacement des tâches élémentaires avec `R`.

Les recommandations sont adaptées au contexte de travail des agents du service statistique public.

--

.sauterligne[
Trois caractéristiques importantes :
]

- Cette documentation est issue de la mise en commun des connaissances des agents du SSP sur `R` dans une approche collaborative, sur le modèle de Wikipedia ;
- Cette documentation ne prétend pas être exhaustive ou sans erreurs ;
- Cette documentation n'est pas une introduction théorique au langage `R`, mais un aide-mémoire pour le statisticien. Elle ne se substitue donc pas à l'offre de formation existante sur `R`, mais la complète.

---
# Contenu de la documentation

La documentation est structurée en fiches regroupées en deux parties :

<!-- 1. Travailler avec `R` à l'Insee : -->
<!--     + Présentation des espaces de travail informatiques (AUSv3 et SSP Cloud) ; -->
<!--     + Comment configurer sa session `R` ; -->
<!--     + Comment installer et utiliser des _packages_ `R` ; -->
<!--     + Comment utiliser RStudio et les `RProject` ; -->
<!--     + Comment configurer et utiliser `git` et Gitlab avec RStudio ; -->
<!--     + Comment choisir un _package_ -->
<!-- 2. Réaliser des tâches élémentaires avec `R` :  -->
<!--     + Importer des données (SAS, csv, txt, odt, xlsx...) ; -->
<!--     + Manipuler des données (table des données, données textuelles, données spatiales) ; -->
<!--     + Utiliser des bases de données PostgreSQL et Oracle ; -->
<!--     + Faire des graphiques ; -->
<!--     + Rédiger des documents avec `R Markdown` ; -->
<!--     + Produire des rapports automatisés avec `R Markdown`. -->

---
# Plan de la documentation
## Première partie : comment (bien) travailler avec `R`

.small90[
<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:center;text-align: center;"> Partie </th>
   <th style="text-align:left;text-align: center;"> Fiches </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;width: 6cm; font-weight: bold;vertical-align: middle !important;" rowspan="4"> Utiliser <code class="remark-inline-code">R</code> à l’Insee </td>
   <td style="text-align:left;width: 12cm; "> Les environnements de travail avec <code class="remark-inline-code">R</code> à l'Insee : AUSv3 et SSP Cloud </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Configurer <code class="remark-inline-code">Git</code> et Gitlab </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Personnaliser la configuration de <code class="remark-inline-code">R</code> </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Gérer les ressources informatiques avec <code class="remark-inline-code">R</code> </td>
  </tr>
  <tr>
   <td style="text-align:center;width: 6cm; font-weight: bold;vertical-align: middle !important;" rowspan="5"> Mener un projet statistique avec <code class="remark-inline-code">R</code> </td>
   <td style="text-align:left;width: 12cm; "> Utiliser les projets RStudio </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Utiliser <code class="remark-inline-code">Git</code> et Gitlab avec RStudio </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Installer des packages et gérer les dépendances </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Choisir des packages </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Demander de l'aide et se documenter </td>
  </tr>
</tbody>
</table>
]

---
# Plan de la documentation
## Seconde partie : réaliser les tâches élémentaires avec `R`

.small90[
<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:center;text-align: center;"> Partie </th>
   <th style="text-align:left;text-align: center;"> Fiches </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;width: 6cm; font-weight: bold;vertical-align: middle !important;" rowspan="3"> Importer des données </td>
   <td style="text-align:left;width: 12cm; "> Importer des données (SAS, csv, txt, odt, xlsx...) </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Utiliser une API </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Utiliser des bases de données </td>
  </tr>
  <tr>
   <td style="text-align:center;width: 6cm; font-weight: bold;vertical-align: middle !important;" rowspan="5"> Manipuler des données </td>
   <td style="text-align:left;width: 12cm; "> Manipuler des données avec <code class="remark-inline-code">data.table</code> </td>
  </tr>
   <tr>
   <td style="text-align:left;width: 12cm; "> Manipuler des données avec le <code class="remark-inline-code">tidyverse</code> </td>
   <tr>
   <td style="text-align:left;width: 12cm; "> Manipuler des données textuelles </td>
  </tr>
  <tr>
   <td style="text-align:left;width: 12cm; "> Manipuler des données spatiales</td>
   </tr>
  <tr>
   <td style="text-align:left;width: 12cm; "> Utiliser des données d'enquête </td>
  </tr>
  <tr>
   <td style="text-align:center;width: 6cm; font-weight: bold;vertical-align: middle !important;" rowspan="3"> Produire des <em>outputs</em> </td>
   <td style="text-align:left;width: 12cm; "> Réaliser des graphiques </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Rédiger des documents avec <code class="remark-inline-code">R Markdown</code>  </td>
  </tr>
  <tr>
   
   <td style="text-align:left;width: 12cm; "> Produire des rapports automatisés </td>
  </tr>
</tbody>
</table>
]

---
# Contenu de la documentation

Les fiches de la documentation ont un certain nombre de caractéristiques communes :

- Elles formulent des recommandations précises et présentent en détail les outils et _packages_ adaptés ;
- Elles proposent des exemples reproductibles utilisant des données de l'Insee pour aider les agents à s'approprier les outils ;
- Elles comportent des conseils et des remarques relatifs aux bonnes pratiques ;
- Elles donnent des indications sur les spécificités informatiques de l'Insee.

---
# Contenu de la documentation
## Des recommandations précises

.sauterligne[

- Les fiches commencent systématiquement par des **recommandations** précises sur les outils et les _packages_ à utiliser ou à éviter. 
- Ces recommandations sont cohérentes avec celles du COPS (Comité de certification des _packages_ `R`).
]

--

.sauterligne2[
.small90[
.indent[
.recommandation[
* Pour importer des données de taille réduite (jusqu'à 1 Go), il est recommandé d'utiliser les fonctions `read_csv()` et `read_delim()` du *package* `readr` ;
* Pour importer des données de taille plus importante (supérieure à 1 Go), il est recommandé d'utiliser la fonction `fread()` du *package* `data.table`.
* L'usage du *package* `csvread` est déconseillé, de même que l'utilisation des fonctions natives de `R` `read.csv()` et `read.delim()`.
]
]
]
]

---
# Contenu de la documentation
## Une présentation détaillée des outils recommandés

Les fiches présentent en détail les outils et les _packages_ les plus adaptés pour réaliser la tâche considérée : 

- cas d'usage précis
- utilisation des fonctions, et de leurs options.

--

.sauterligne[
Le *package* `data.table` permet d'importer des fichiers plats avec la fonction `fread()`. Cette fonction présente trois avantages [...]
]

--


.sauterligne[
Les principales options de `fread()` sont les suivantes :
]
.small90[
| Argument         | Valeur par défaut                           | Fonction                                                              |
|------------------|---------------------------------------------|-----------------------------------------------------------------------|
| `file`             | Aucune                                      | Le chemin du fichier à importer                                       |
| `nrows`            | `Inf`                                         | Nombre maximum de lignes à importer (pas de limite par défaut)        |
| `select`           | `NULL`                                        | Sélectionner les colonnes à importer                                  |
| `encoding`         | `"unknown"`                                   | Définir l'encodage du fichier (`"UTF-8"` ou `"Latin-1"`)                                        |
]

---
# Contenu de la documentation
## Des exemples de code reproductibles et proches des cas d'usage

La documentation comporte de nombreux exemples. Ces exemples ont trois particularités :

- Les agents peuvent reproduire presque tous les exemples de la documentation sur leur poste (ou dans AUSv3 ou sur le SSP) en recopiant le code des exemples ;
- les exemples utilisent des données disponibles sur [insee.fr](www.insee.fr) (code officiel géographique, base permanente des équipements, répertoire Filosofi) ;
- les données utilisées dans les exemples sont mises à disposition sous forme du _package_ `doremifasolData` développé par Pierre Lamarche et Pierre-Yves Berrard.

---
# Contenu de la documentation
## Des exemples de code reproductibles et proches des cas d'usage


```{r, echo = TRUE, warning = FALSE, message = FALSE}
library(doremifasolData)
library(magrittr)
library(dplyr)

nombre <- bpe_ens_2018 %>%
  as_tibble() %>%
  filter(TYPEQU == "B316") %>% 
  group_by(DEP) %>% 
  summarise(nombre_station_serv = sum(NB_EQUIP, na.rm = TRUE)) 
nombre
```



**exemples de code reproductibles et proches des cas d'usage**. 




---
# Contenu de la documentation
## Conseils et remarques

Les fiches contiennent des **conseils** et des **remarques** avec trois objectifs :
- orienter les agents en fonction de leur niveau en `R` ;
- aider les agents à s'approprier l'environnement `R` ;
- indiquer les bonnes pratiques à adopter.

--

.small90[
.indent[
.conseil[
Si vous êtes complètement débutants en `R`, il est recommandé d'utiliser l'utilitaire d'importation de ` RStudio`. Une fois que les données sont correctement importées, vous pourrez copier-coller le code dans votre script `R` et vous familiariser avec les fonctions du *package* `readr`.
]

.remarque[
Il est nettement plus simple de sélectionner des colonnes avec `fread()` qu'avec les fonctions du *package* `readr`. Il est donc recommandé d'utiliser `fread()` lorsque vous souhaitez sélectionner facilement les colonnes à importer.
]

<!-- .specificite[ -->
<!-- La direction générale de l'Insee est située à Montrouge. -->
<!-- ] -->
]
]

<!-- IL FAUDRAIT METTRE UN EXEMPLE DE CODE -->

    
---
# Diffusion de la documentation

La documentation est diffusée sous deux formes :

- un site internet ([www.utilitr.org](www.utilitr.org)) déjà disponible ;
- une brochure pdf imprimable (en cours d'élaboration).

--

Le site internet est actualisé en continu, tandis que la brochure pdf est publiée de façon ponctuelle et millésimée.

---

# Positionnement du projet à l'Insee

Le projet est l’une des multiples initiatives lancées pour faciliter la
transition vers `R` : 
+ Supports du groupe de travail USSR ;
+ FunCamp dévéloppé par la Division Innovation et Instruction Technique (Diit) ;
+ Guide à l'usage du statisticien débutant (Cédric Afsa) ;
+ Formation Travail collaboratif avec `R` (actuellement en rodage).

Les recommandations de *packages* sont cohérentes avec celles du Comité de certification des _packages_ `R` (COPS).

La documentation prend en compte l'évolution de l’environnement informatique du statisticien :
+ Modernisation des serveurs partagés (AUSv3) ;
+ Création de la plateforme [SSP-cloud](https ://datalab.sspcloud.fr/accueil) développée par la Diit ;
+ Présentation des outils assurant la qualité des programmes en `R` comme les `Rprojects` et le contrôle de version avec `git` et Gitlab.

L'articulation entre `utilitR` et l'offre de formation sur `R` n'est pas encore clairement établie.

---
# Spécificités du projet : organisation

**Le projet `utilitR` est un projet collaboratif, horizontal, _open source_ et ouvert à tous, auquel tous les agents peuvent contribuer.**

--
* Cinq principes détaillés dans le [manifeste](https://github.com/InseeFrLab/utilitR/blob/master/Manifeste.md) : transparence, ouverture, bienveillance, exigence et reproductibilité.

--

* Organisation sans hiérarchie :
    * Un _groupe de contributeurs_ (environ 15), parmi lesquels deux coordinateurs (Lino Galiana et Olivier Meslin) ;
    * Un _comité de parrainage_ composé de managers : Benoît Rouppert, Arnaud Degorre, Patrick Sillard, Sébastien Roux.
--
* La marche à suivre pour contribuer est détaillée dans le [guide de contribution](https://github.com/InseeFrLab/utilitR/blob/master/CONTRIBUTING.md).


---
# Spécificités du projet : méthode de travail

Le projet `utilitR` est entièrement développé avec des outils collaboratifs :

- Tous les codes du projet sont stockés sur un dépôt Github ([https://github.com/InseeFrLab/utilitR](lien)) et disponibles sous licence libre ;
- Les travaux sont menés selon les méthodes de développement logiciel (_pull requests_, _issues_) ;
- Toutes les contributions sont soumises à une relecture par les pairs et validées collégialement (sur le modèle de Wikipedia).

---

# Où en est le projet aujourd'hui ?

* Un portail d'accès sous forme de site *web* :
    + La documentation principale est disponible sur [www.book.utilitr.org](www.book.utilitr.org) ;
    + Guide des bonnes pratiques en `R` disponible sur [www.pratiques.utilitr.org](www.pratiques.utilitr.org).
    
--

* Prochaines étapes :
    + Mars 2021 : finalisation des contenus ;
    + Avril 2021 : finalisation de la mise en forme ;
    + Juin 2021 : diffusion de la V1 de la brochure pdf.

---
background-image: url('resources/logo-utilitr.png')
background-size: 7cm
background-position: 8.5cm 3cm

# Merci !
